
CREATE USER BDDAdmin IDENTIFIED BY TPAdmin ;

GRANT ALL PRIVILEGES TO BDDAdmin;

CONNECT BDDAdmin/TPAdmin


CREATE TABLE Etudiant
(
  MATRICULE_ETU   NUMBER(10)   PRIMARY KEY, 
  NOM_ETU         VARCHAR(20)  NOT NULL, 
  PRENOM_ETU      VARCHAR(10)  NOT NULL, 
  DATE_NAISSANCE  VARCHAR(10)  NOT NULL
);

CREATE TABLE ENSEIGNANT  
( 
    MATRICULE_ENS  NUMBER(10)         PRIMARY KEY, 
    NOM_ENS        VARCHAR(20)        NOT NULL, 
    PRENOM_ENS     VARCHAR(20)        NOT NULL, 
    AGE            NUMBER(10)         NOT NULL  
); 

CREATE TABLE UNITE  
( 
  CODE_UNITE     VARCHAR(30)  PRIMARY KEY, 
  LIBELLE        VARCHAR(30)  NOT NULL, 
  NBR_HEURES     NUMBER(5)    NOT NULL, 
  MATRICULE_ENS  NUMBER(10)   NOT NULL,
  CONSTRAINT FK_MAT_ENS FOREIGN KEY (MATRICULE_ENS) REFERENCES ENSEIGNANT (MATRICULE_ENS)
);

CREATE TABLE ETUDIANTUNITE  
( 
   MATRICULE_ETU   NUMBER(10)    NOT NULL, 
   CODE_UNITE      VARCHAR(30)   NOT NULL, 
   NOTE_CC         NUMBER(10)   NOT NULL, 
   NOTE_TP         NUMBER(10)   NOT NULL, 
   NOTE_EXAMEN     NUMBER(10)   NOT NULL, 
   CONSTRAINT      PK_MATE_CODU  PRIMARY KEY (MATRICULE_ETU,CODE_UNITE),
   CONSTRAINT      FK_MAT_ETU    FOREIGN KEY (MATRICULE_ETU) REFERENCES ETUDIANT (MATRICULE_ETU), 
   CONSTRAINT      FK_COD_UNI    FOREIGN KEY (CODE_UNITE)    REFERENCES UNITE    (CODE_UNITE ) 
);  


CREATE USER Etudiant IDENTIFIED BY TPEtudiant ;
GRANT SELECT ON Etudiant TO Etudiant;
GRANT CREATE SESSION TO Etudiant;


CREATE USER ENSEIGNANT IDENTIFIED BY TPEnseignant ;
GRANT SELECT, INSERT ON ENSEIGNANT TO ENSEIGNANT;

GRANT CREATE SESSION TO ENSEIGNANT;


ALTER TABLE Etudiant ADD (Adresse varchar(100));


ALTER TABLE ENSEIGNANT DROP (AGE);


ALTER TABLE Etudiant ADD CONSTRAINT CK_MATRICULE_ETU CHECK (MATRICULE_ETU BETWEEN 20190000 AND 20199999);


ALTER TABLE Etudiant MODIFY (PRENOM_ETU VARCHAR(15)); 


INSERT INTO Etudiant  VALUES (20190001,'BOUSSAI','MOHAMED','12/01/2000','Alger'); 
INSERT INTO Etudiant  VALUES (20190002,'CHAID','LAMIA', '01/10/1999','Batna'); 
INSERT INTO Etudiant  VALUES (20190003,'BRAHIMI','SOUAD','18/11/2000','Sétif'); 
INSERT INTO Etudiant  VALUES (20190004,'LAMA','SAID','23/05/1999','Oran'); 

INSERT INTO ENSEIGNANT   VALUES (20190001,'HAROUNI','AMINE'); 
INSERT INTO ENSEIGNANT   VALUES (19990011,'FATHI','OMAR'); 
INSERT INTO ENSEIGNANT   VALUES (19980078,'BOUZIDANE','FARAH'); 
INSERT INTO ENSEIGNANT   VALUES (20170015,'ARABI','ZOUBIDA'); 
 
INSERT INTO  UNITE VALUES ( 'FEI0001','POO',6,20190001); 
INSERT INTO  UNITE VALUES ('FEI0002','BDD',6,19990011); 
INSERT INTO  UNITE VALUES ('FEI0003','RESEAU',3,20170015); 
INSERT INTO  UNITE VALUES ('FEI0004','SYSTEME',6,19980078); 
 
INSERT INTO ETUDIANTUNITE VALUES (20190001,'FEI0001',10,15,9); 
INSERT INTO ETUDIANTUNITE VALUES (20190002,'FEI0001',20,13,10); 
INSERT INTO ETUDIANTUNITE VALUES (20190004,'FEI0001',13,17,16); 
INSERT INTO ETUDIANTUNITE VALUES (20190002,'FEI0002',10,16,17); 
INSERT INTO ETUDIANTUNITE VALUES (20190003,'FEI0002',9,8,15); 
INSERT INTO ETUDIANTUNITE VALUES (20190004,'FEI0002',15,9,20); 
INSERT INTO ETUDIANTUNITE VALUES (20190002,'FEI0004',12,18,14); 
INSERT INTO ETUDIANTUNITE VALUES (20190003,'FEI0004',17,12,15); 
INSERT INTO ETUDIANTUNITE VALUES (20190004,'FEI0004',12,13,20);


UPDATE ETUDIANTUNITE SET NOTE_CC=NOTE_CC+2 WHERE MATRICULE_ETU IN (SELECT MATRICULE_ETU FROM Etudiant WHERE NOM_ETU LIKE 'B%');


UPDATE ETUDIANTUNITE SET NOTE_EXAMEN=0 WHERE CODE_UNITE IN (SELECT CODE_UNITE FROM UNITE WHERE LIBELLE='SYSTEME');







SELECT NOM_ETU,PRENOM_ETU FROM Etudiant WHERE MATRICULE_ETU IN (SELECT MATRICULE_ETU FROM ETUDIANTUNITE WHERE NOTE_EXAMEN =20);


  
SELECT NOM_ETU,PRENOM_ETU FROM Etudiant WHERE MATRICULE_ETU IN ((SELECT MATRICULE_ETU FROM ETUDIANT MATRICULE_ETU) MINUS (SELECT MATRICULE_ETU FROM ETUDIANTUNITE WHERE CODE_UNITE IN(SELECT CODE_UNITE FROM UNITE WHERE LIBELLE='POO'))); 


SELECT LIBELLE FROM UNITE WHERE CODE_UNITE NOT IN (SELECT CODE_UNITE FROM ETUDIANTUNITE);



Select nom_etu,prenom_etu,((note_CC+note_TP+(note_examen*2))/4) as moy , libelle From Etudiant,EtudiantUnite,Unite WHERE EtudiantUnite.code_unite = Unite.code_unite and EtudiantUnite.matricule_etu = Etudiant.matricule_etu;
